## The Mental Compass — Copilot instructions

Be concise and make minimal, correct edits. This project is a React + Vite app with Supabase integration and a small serverless/edge-function fallback. Use the hints below to be immediately productive.

- Project entry & scripts:

  - Root scripts: run `npm i` then `npm run dev` for development. Vite server port defaults to 3000 (see `vite.config.ts`). On PowerShell set an env var with `$env:PORT=3000; npm run dev` if you need a custom port.
  - Build output: `npm run build` -> `build/`. Serve with `npm start` which runs `serve -s build -l $PORT` (note env var semantics on Windows vs POSIX).

- Architecture & key locations:

  - `src/` contains the app. Routes are declared in `src/App.tsx` and pages live in `src/pages/`.
  - Reusable UI primitives live under `src/components/ui/` (Radix primitives + Tailwind/CVA patterns). Use these components rather than creating new, duplicate primitives.
  - Page-level sections and composite components are in `src/components/` (e.g., `CommunitySection.tsx`, `AppointmentSection.tsx`). Use these as examples for data fetching and state patterns.
  - Auth and profile context: `src/contexts/AuthContext.tsx` and `src/contexts/UserProfileContext.tsx`. Read `AuthContext` comments: the app prefers an edge function at `/functions/v1/server` but silently falls back to direct Supabase metadata if the function is unavailable.
  - Supabase config: `src/utils/supabase/info.tsx` (AUTOGENERATED — do not edit secrets here). Many files use `projectId` to call edge functions at `https://<projectId>.supabase.co/functions/v1/server/...`.
  - Serverless functions (source) are under `supabase/functions/server/` in the repo (look there when changing server-side behavior).

- Conventions & patterns to follow:

  - Imports: `vite.config.ts` aliases `@` -> `./src`. Prefer `@/components/...` or `@/utils/...` for cross-file imports.
  - UI: components in `src/components/ui/` use class-variance-authority (`cva`) and `tailwind-merge`. Follow their pattern for variants and utility merging.
  - Data fetching: prefer the contextual helpers in `contexts/` (Auth/UserProfile) and use the existing edge function endpoints before adding new direct Supabase calls.
  - Edge vs client: Auth flows try edge endpoints first (see `AuthContext.signup` and `login`); if you change auth flows, update both the client contexts and the corresponding serverless function.

- Debugging & local dev notes:

  - If an edge function is not available, the app intentionally falls back silently — look at `AuthContext` for how fallback occurs (no user-facing error). Use network tab to check whether requests hit `.../functions/v1/server/...` or not.
  - If changing aliases or package mappings, update `vite.config.ts` (there are explicit aliases for some packages to simplify imports).

- Safety & repo hygiene:

  - `src/utils/supabase/info.tsx` contains a `publicAnonKey`. Treat private keys securely; do not commit private credentials. The file is marked AUTOGENERATED.

- Good starter tasks for AI edits:
  - Small UI fix: update a component in `src/components/` and run `npm run dev` to verify.
  - Auth debug: add logging around `AuthContext.checkUser()` and verify whether edge-function calls return 200 or the code falls back to Supabase metadata.

If anything above is unclear or you'd like more examples (imports, a recommended dev command for PowerShell, or guidance about the serverless function layout), tell me which part and I'll expand or adjust this file.
